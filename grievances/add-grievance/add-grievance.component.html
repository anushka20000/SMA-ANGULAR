<form [formGroup]="addForm" (ngSubmit)="onInsert(addForm.value)">
    <div>
               
      
        <div class="card shadow-none rounded-0 w-100">
            <div class="card-header">
                <h3 class="card-title fw-bolder text-dark">New {{entityName}}</h3>
            </div>
            <div class="card-body position-relative">
                <div>

                    <!--Modify the form according to field Start-->
                    <div class="row mb-6">
                        <div class="col-lg-6">

                            <label class="col-form-label required fw-bold fs-6">Select School</label>
                            <div class="fv-row">
                                <ng-select
                                [(ngModel)]="schoolId"
                                (change)="loadAssets()"
                                (change)="loadIssues($event)"
                                (change)="loadEngineers($event)"
                                (change)="loadOem()"
                                formControlName="school_id" 
                                 [items]="schoolList"
                                [multiple]="false"
                                [closeOnSelect]="true"
                                [searchable]="true"
                                placeholder="Select School"
                                bindLabel="name"
                                bindValue="id"
     
                     >
                    
                     </ng-select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('school_id')?.touched && addForm.get('school_id')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-form-label required fw-bold fs-6">Select Asset</label>
                            <div class="fv-row">
                                <ng-select
                                [(ngModel)]="assetId"
                                (change)="loadIssues($event)"
                                formControlName="asset_id" 
                                 [items]="assetList"
                                [multiple]="false"
                                [closeOnSelect]="true"
                                [searchable]="true"
                                placeholder="Select Asset"
                                bindLabel="name"
                                bindValue="id" 
                     >
                     <ng-template ng-label-tmp let-item="item">
                        {{ item.model && item.model }} - {{ item.serial_no && item.serial_no }}
                      </ng-template>
                      <ng-template ng-option-tmp let-item="item">
                        Model - {{ item.model && item.model}} - Serial No. - {{ item.serial_no && item.serial_no }}
                      </ng-template>
                     </ng-select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('asset_id')?.touched && addForm.get('asset_id')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                    </div>
                 

                    <div class="row mb-6">
                        <div class="col-lg-6">
                            <label class="col-form-label required fw-bold fs-6">Select Issue</label>
                            <div class="fv-row">
                                <ng-select
                                [(ngModel)]="issueId"
                                formControlName="issue_id" 
                                 [items]="issueList"
                                [multiple]="false"
                                [closeOnSelect]="true"
                                [searchable]="true"
                                placeholder="Select Issue"
                                bindLabel="description"
                                bindValue="id"
     
                     >
                     </ng-select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('issue_id')?.touched && addForm.get('school_issue_idtype')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6" *ngIf="user.type == 1 || user.type == 6 || user.type == 5">
                            <label class="col-form-label required fw-bold fs-6">Select Service Engineer</label>
                            <div class="fv-row">
                                <ng-select
                                [(ngModel)]="serviceEngineerId"
                                formControlName="service_engineer" 
                                 [items]="engineerList"
                                [multiple]="false"
                                [closeOnSelect]="true"
                                [searchable]="true"
                                [disabled]="true"
                                placeholder="Select Service Engineer"
                                bindLabel="user_name"
                                bindValue="id"
     
                     >
                     </ng-select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('service_engineer')?.touched && addForm.get('service_engineer')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                       
                    </div>
          

                    <div class="row mb-6" >
                        <div class="col-lg-6" *ngIf="user.type == 1 || user.type == 6 || user.type == 5">
                            <label class="col-form-label  fw-bold fs-6">Select OEM</label>
                            <div class="fv-row">
                                <ng-select
                                [(ngModel)]="projectTypeId"
                                formControlName="oem_id" 
                                 [items]="oemList"
                                [multiple]="false"
                                [closeOnSelect]="true"
                                [searchable]="true"
                                placeholder="Select Oem"
                                bindLabel="user_name"
                                bindValue="id"
     
                     >
                     </ng-select>
                                <!-- <div class="fv-plugins-message-container" *ngIf="addForm.get('oem_id')?.touched && addForm.get('oem_id')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div> -->
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <label class="col-form-label required fw-bold fs-6">Support Type</label>
                            <div class="fv-row">
                                <select formControlName="support_type" name="support_type" required class="form-select form-select-solid form-select-lg fw-bold">
                                    <option value="" disabled [defaultSelected]="true">Select Support Type</option>
                                    <option value="1">Technical</option>
                                    <option value="2">Non-Technical</option>
                                </select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('support_type')?.touched && addForm.get('support_type')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                       
                    </div>
            

                    <div class="row mb-6">
                        <div class="col-lg-6">
                            <label class="col-form-label fw-bold fs-6 required">Description</label>
                            <div class="fv-row">
                                <textarea formControlName="description" name="description" placeholder="Description"  required class="form-control form-control-lg form-control-solid" rows="5"></textarea>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('description')?.touched && addForm.get('description')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="col-lg-6">
                            <label class="col-form-label fw-bold fs-6">Upload File</label>
                            <div class="fv-row">
                                <input formControlName="file" name="file" placeholder="File"  type="file" (change)="onFileChange($event)"  class="form-control form-control-lg form-control-solid"/>
                               
                            </div>
                        </div> -->
                        <div class="col-lg-6">
                            <label class="col-form-label fw-bold fs-6">Upload File</label>

                            <ngx-dropzone (change)="uploadFile($event)" [multiple]="false" 
                      class="notice d-flex bg-light-primary rounded border-primary border border-dashed p-6 horizontal-box custom-dropzone">
            <ngx-dropzone-label>Select File to Upload</ngx-dropzone-label>
    
            <ngx-dropzone-preview  [file]="pdfFile" *ngIf="pdfFile" [removable]="true"  (removed)="onRemovePdf(pdfFile)">
                <ngx-dropzone-label>{{ pdfFile.name }}</ngx-dropzone-label>
            </ngx-dropzone-preview>
        </ngx-dropzone>
                        </div>
                    </div>

               

                    <div class="row mb-6" >
                        <div class="col-lg-6" *ngIf="user.type == 3">
                            <label class="col-form-label required fw-bold fs-6">Status</label>
                            <div class="fv-row">
                                <select formControlName="status" name="status" required class="form-select form-select-solid form-select-lg fw-bold">
                                    <option value="" disabled >Select Status</option>
                                    <option value="0" [defaultSelected]="true">Unassigned</option>
                                    <!-- <option *ngIf="user.type != 3" value="1">Assigned</option>
                                    <option *ngIf="user.type != 3" value="2">Assigned OEM</option>
                                    <option *ngIf="user.type != 3" value="3">Completed OEM</option>
                                    <option *ngIf="user.type != 3" value="4">Unresolved</option>
                                    <option *ngIf="user.type != 3" value="5">Completed</option> -->
    
                                </select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('status')?.touched && addForm.get('status')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6" *ngIf="user.type == 1 || user.type == 5">
                            <label class="col-form-label required fw-bold fs-6">Status</label>
                            <div class="fv-row">
                                <select formControlName="status" name="status" required class="form-select form-select-solid form-select-lg fw-bold">
                                    <option value="" disabled [defaultSelected]="true">Select Status</option>
                                    <option value="0" >Unassigned</option>
                                    <option value="1">Assigned</option>
                                    <option value="2">Assigned OEM</option>
                                    <option value="3">Completed OEM</option>
                                    <option value="4">Unresolved</option>
                                    <option value="5">Completed</option>
    
                                </select>
                                <div class="fv-plugins-message-container" *ngIf="addForm.get('status')?.touched && addForm.get('status')?.hasError('required')">
                                    <div class="fv-help-block"> This is a required field</div>
                                </div>
                            </div>
                        </div>
                        
                    </div>


                 
                
                    
                    <div class="col-lg-12 fv-row" style="text-align: left">
                        <button [disabled]="!addForm.valid" class="btn btn-primary" type="submit" >
                            <ng-container *ngIf="!isLoading">Save Changes</ng-container>
                            <ng-container *ngIf="isLoading">
                              <span [style.display]="'block'" clas="indicator-progress">
                                Please wait...{{ " " }}
                                  <span
                                          class="spinner-border spinner-border-sm align-middle ms-2"
                                  ></span>
                              </span>
                            </ng-container>
                        </button>
                    </div>

                    <!--Modify the form according to field End-->


                </div>
            </div>
        </div>
    </div>

</form>
